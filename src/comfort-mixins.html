<script>
  // (function () {
  'use strict';

  window.Comfort = window.Comfort || {};

  Comfort.PseudoForm = (superclass) => class extends superclass {
    _storeAnswers( event ) {
      function formatResponse( question, questionNumber, selected, selectedNumber ) {
        var response = {};

        response.question = question.question;
        response.number = questionNumber;
        response.type = question.type;
        response.answer = selected;
        response.answer.number = selectedNumber;

        return response;
      }

      const $form = this.shadowRoot.querySelector( '#pretest-form' );

      // var values = {};
      var responses = [];

      // console.log( '$form.elements', $form.elements );
      var $element, question, selected, questionXPath;

      for ( var i = 0; i < $form.elements.length; i++ ) {
        $element = $form.elements[i];

        questionXPath = '//d:item[' + parseInt( $element.name, 10 ) + ']';

        question = JSON.search( this.snapshot, questionXPath )[0];

        switch ( $element.type ) {
          case 'radio':
          case 'checkbox':
            if ( $element.checked ) {
              selected = JSON.search( this.snapshot, questionXPath + '/answers[' + $element.value + ']' )[0];
              
              responses.push( formatResponse( question, $element.name, selected, $element.value ) );
            } 
          break;

          default:
            responses.push( formatResponse( question, $element.name, { "text": $element.value, "correct": null }, '1' ) );
        }
      }

      // console.log( 'responses', responses );
      Comfort.User.answers.pretest = responses;

      console.log( 'Comfort.User', Comfort.User );

      // event.preventDefault();
    }
  };
  // })();
</script>