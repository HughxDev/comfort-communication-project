<link rel="import" href="shared-styles.html"><link rel="import" href="comfort-button.html"><dom-module id="comfort-done"><template><style include="shared-styles">:host{display:block}</style><section><header><h1 class="section-title">Thank You</h1></header><p>Support of the family caregiver enables family members to best support the patient. Thank you for completing this module.</p><comfort-button href="[[rootPath]]">Restart</comfort-button></section></template><script src="/family/bower_components/papaparse/papaparse.min.js"></script><script>"use strict";Polymer({is:"comfort-done",ready:function(){function e(e){return e?e.toString().replace(/[“”]/g,'"').replace(/[‘’]/g,"'"):e}try{for(var t,s,r=moment().format("YYYY-MM-DD HH:mm"),a=JSON.parse(localStorage.getItem("user")),n=["pretest","posttest"],o={pretest:[],posttest:[]},p=0;p<n.length;p++){t=n[p];for(var c=0;c<a.answers[t].length;c++){s={};for(var l in a.answers[t][c])if("answer"===l)for(var u in a.answers[t][c].answer)s["answer_"+u]=e(a.answers[t][c].answer[u]);else switch(l){case"question":s[l+"_text"]=e(a.answers[t][c][l]);break;case"number":case"type":s["question_"+l]=e(a.answers[t][c][l]);break;default:s[l]=e(a.answers[t][c][l])}o[t].push(s)}}console.log("output",o);var i=Papa.unparse(o.pretest,{quotes:[!1,!1,!1,!0,!1,!1]})+"\n---pretest/posttest separator---\n"+Papa.unparse(o.posttest,{quotes:[!1,!1,!1,!0,!1,!1]})+"\n---pretest/posttest separator---\n\nDate Started: "+a.dateStarted+"\nDate Ended: "+r;console.log("csv",i);var g=new XMLHttpRequest;g.onreadystatechange=function(){4===g.readyState&&(200===g.status?console.log("Everything’s copacetic"):console.log("Got a "+g.status+" error:",g.responseText,g))},g.open("POST","/family/src/email.php"),g.setRequestHeader("Content-Type","text/plain"),g.send(i)}catch(e){console.log("Error: ",e)}}});</script></dom-module>